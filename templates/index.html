<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>For Glory!</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>
	(function() {
	  if (localStorage.getItem("theme") === "dark") {
		document.documentElement.classList.add("dark");
	  }
	})();
  </script>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
	<div class="header-row">
	  <h1 class="title">–†–µ–π—Ç–∏–Ω–≥</h1>
	  <button type="button" id="theme-toggle" class="theme-toggle" onclick="toggleTheme()">
		<span id="theme-icon">üåô</span>
	  </button>
	</div>

	<form method="post" class="form">

	  <div class="form-row">
		<label><input type="radio" name="mode" value="–û–±—â–∏–π"
		  {% if mode == '–û–±—â–∏–π' %}checked{% endif %}
		  onchange="this.form.submit()"> –û–±—â–∏–π</label>

		<label><input type="radio" name="mode" value="–ü—Ä–∏—Ä–æ—Å—Ç"
		  {% if mode == '–ü—Ä–∏—Ä–æ—Å—Ç' %}checked{% endif %}
		  onchange="this.form.submit()"> –ü—Ä–∏—Ä–æ—Å—Ç</label>
	  </div>

	  <div class="form-row">
		<input type="text" name="filter" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∏–∫—É" value="{{ filter_value }}" onchange="this.form.submit()">
	  </div>

	  {% if mode == '–û–±—â–∏–π' %}
		<div class="form-row">
		  <select name="file" onchange="this.form.submit()">
			{% for f in json_files %}
			  <option value="{{ f }}" {% if f == selected_file %}selected{% endif %}>
				{{ extract_datetime_from_filename(f).strftime('%d.%m.%Y %H:%M') }}
			  </option>
			{% endfor %}
		  </select>
		</div>
	  {% elif mode == '–ü—Ä–∏—Ä–æ—Å—Ç' %}
		<div class="form-row">
		  <label>–æ—Ç</label>
		  <select name="file1" onchange="this.form.submit()">
			{% for f in json_files %}
			  <option value="{{ f }}" {% if f == file1 %}selected{% endif %}>
				{{ extract_datetime_from_filename(f).strftime('%d.%m.%Y %H:%M') }}
			  </option>
			{% endfor %}
		  </select>
		  <label>–¥–æ</label>
		  <select name="file2" onchange="this.form.submit()">
			{% for f in json_files %}
			  <option value="{{ f }}" {% if f == file2 %}selected{% endif %}>
				{{ extract_datetime_from_filename(f).strftime('%d.%m.%Y %H:%M') }}
			  </option>
			{% endfor %}
		  </select>
		</div>
	  {% endif %}

	  <div class="form-row">
		<label>–ü–∞—Ä–∞–º–µ—Ç—Ä</label>
		<select name="param" onchange="this.form.submit()">
		  {% for p in param_selectable %}
			<option value="{{ p }}" {% if p == param %}selected{% endif %}>{{ p }}</option>
		  {% endfor %}
		</select>

		<select name="sort" onchange="this.form.submit()">
		  <option value="desc" {% if sort_dir == 'desc' %}selected{% endif %}>–ü–æ —É–±—ã–≤–∞–Ω–∏—é</option>
		  <option value="asc" {% if sort_dir == 'asc' %}selected{% endif %}>–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
		</select>
	  </div>

	</form>

	<p class="date-label">{{ filename_display }}</p>

	{% if rating and rating[0]|length == 4 %}
	  <table>
		<thead>
		  <tr>
			<th>‚Ññ</th>
			<th>–ò–≥—Ä–æ–∫</th>
			<th>{{ "–°–ª–∞–≤–∞" if "—Å–ª–∞–≤–µ" in param else "–°—É–º–º–∞ —Å—Ç–∞—Ç–æ–≤" if "—Å—Ç–∞—Ç–∞–º" in param else param }}</th>
		  </tr>
		</thead>
		<tbody>
		  {% for idx, row in enumerate(rating, 1) %}
			{% set pid, name, level, value = row %}
			<tr class="{{ 'gold' if idx == 1 else 'silver' if idx == 2 else 'bronze' if idx == 3 else '' }} {{ 'even' if loop.index0 % 2 == 0 else 'odd' }}">
			  <td class="center">{{ idx }}</td>
			  <td style="text-align: left;">
				<a href="https://wekings.online/hero/detail?player={{ pid }}" target="_blank">
				  {{ name }} [{{ level }}]
				</a>
			  </td>
			  <td class="center">{{ value }}</td>
			</tr>
		  {% endfor %}
		</tbody>
	  </table>

	{% elif rating and rating[0]|length == 3 %}
	  <table>
		<thead>
		  <tr>
			<th>‚Ññ</th>
			<th>–ì—Ä—É–ø–ø–∞</th>
			<th>{{ "–°–ª–∞–≤–∞" if "—Å–ª–∞–≤–µ" in param else "–°—É–º–º–∞ —Å—Ç–∞—Ç–æ–≤" }}</th>
		  </tr>
		</thead>
		<tbody>
		  {% for idx, group in enumerate(rating, 1) %}
			{% set group_name, total, members = group %}
			<tr class="group-header {{ 'gold' if idx == 1 else 'silver' if idx == 2 else 'bronze' if idx == 3 else '' }}">
			  <td class="center">{{ idx }}</td>
			  <td colspan="1"><details><summary>{{ group_name }}</summary>
				<ul>
				  {% for pid, name, level, value in members %}
					<li>
					  <a href="https://wekings.online/hero/detail?player={{ pid }}" target="_blank">{{ name }} [{{ level }}]</a>
					  ‚Äî {{ value }}
					</li>
				  {% endfor %}
				</ul>
			  </summary></details></td>
			  <td class="center">{{ total }}</td>
			</tr>
		  {% endfor %}
		</tbody>
	  </table>
	{% endif %}

  </div>

  <script>
	function toggleTheme() {
	  const html = document.documentElement;
	  const isDark = html.classList.toggle("dark");
	  localStorage.setItem("theme", isDark ? "dark" : "light");
	  document.getElementById("theme-icon").textContent = isDark ? "‚òÄÔ∏è" : "üåô";
	}

	window.addEventListener("DOMContentLoaded", () => {
	  const isDark = localStorage.getItem("theme") === "dark";
	  if (isDark) {
		document.documentElement.classList.add("dark");
		document.getElementById("theme-icon").textContent = "‚òÄÔ∏è";
	  } else {
		document.getElementById("theme-icon").textContent = "üåô";
	  }
	});
  </script>
</body>
</html>
