<!DOCTYPE html>
<html lang="ru">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>For Glory!</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
	<div class="header-row">
	  <h1>–†–µ–π—Ç–∏–Ω–≥</h1>
	  <button id="theme-toggle" class="theme-toggle">üåô</button>
	</div>

	<form method="POST" class="form-container">
		<div class="mode-toggle">
		  <input type="radio" id="tab1" name="mode" value="–û–±—â–∏–π"
				 onchange="this.form.submit()" {{ 'checked' if mode == '–û–±—â–∏–π' else '' }}>
		  <label for="tab1">–û–±—â–∏–π</label>

		  <input type="radio" id="tab2" name="mode" value="–ü—Ä–∏—Ä–æ—Å—Ç"
				 onchange="this.form.submit()" {{ 'checked' if mode == '–ü—Ä–∏—Ä–æ—Å—Ç' else '' }}>
		  <label for="tab2">–ü—Ä–∏—Ä–æ—Å—Ç</label>
		</div>

	  <div class="date-select">
		{% if mode == '–ü—Ä–∏—Ä–æ—Å—Ç' %}
		  <div class="row-inline">	
			  <label>–æ—Ç</label>
			  <select name="file1" onchange="this.form.submit()">
				{% for f in json_files %}
				  <option value="{{ f }}" {% if f == file1 %}selected{% endif %}>{{ extract_datetime_from_filename(f).strftime('%d.%m.%Y %H:%M') }}</option>
				{% endfor %}
			  </select>
			  <label>–¥–æ</label>
			  <select name="file2" onchange="this.form.submit()">
				{% for f in json_files %}
				  <option value="{{ f }}" {% if f == file2 %}selected{% endif %}>{{ extract_datetime_from_filename(f).strftime('%d.%m.%Y %H:%M') }}</option>
				{% endfor %}
			  </select>
			</div>
		{% else %}
		  <select name="file" onchange="this.form.submit()">
			{% for f in json_files %}
			  <option value="{{ f }}" {% if f == selected_file %}selected{% endif %}>{{ extract_datetime_from_filename(f).strftime('%d.%m.%Y %H:%M') }}</option>
			{% endfor %}
		  </select>
		{% endif %}
	  </div>

	  <div class="controls-row row-inline">
		<select name="param" onchange="this.form.submit()">
		  {% for p in param_selectable %}
			<option value="{{ p }}" {% if p == param %}selected{% endif %}>{{ p }}</option>
		  {% endfor %}
		</select>

		<select name="sort" onchange="this.form.submit()">
		  {% for s in sort_options %}
			<option value="{{ s }}" {% if s == sort_dir %}selected{% endif %}>
			  {% if s == 'desc' %}–ü–æ —É–±—ã–≤–∞–Ω–∏—é{% else %}–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é{% endif %}
			</option>
		  {% endfor %}
		</select>
	  </div>

	  <div class="filter-row">
		<input type="text" name="filter" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∏–∫—É" value="{{ filter_value }}" onchange="this.form.submit()">
	  </div>
	</form>

	<!-- {% if filename_display %} -->
	  <!-- <p>{{ filename_display }}</p> -->
	<!-- {% endif %} -->

	<table>
	  <thead>
		<tr>
		  <th>‚Ññ</th>
		  <th class="col2">{{ column2_name }}</th>
		  <th class="col3" style="text-align: center;">{{ column3_name }}</th>
		</tr>
	  </thead>
	  <tbody>
		{% if param.startswith('–ö–ª–∞–Ω—ã') or param.startswith('–ë—Ä–∞—Ç—Å—Ç–≤–∞') %}
		  {% for idx, row in enumerate(rating, 1) %}
			<tr class="{% if idx == 1 %}gold{% elif idx == 2 %}silver{% elif idx == 3 %}bronze{% endif %}">
			  <td>{{ idx }}</td>
			  <td>
				<details>
				  <summary>{{ row.name }}</summary>
				  <div class="details">
					<table class="inner-table">
						{% for hero in row.members %}
							<tr>
								<td>{{ hero._rank }}.</td>
								<td>
									<a href="https://wekings.online/hero/detail?player={{ hero.ID }}" target="_blank">
									{{ hero.–ò–º—è }} [{{ hero.–£—Ä–æ–≤–µ–Ω—å }}]
									</a>
								</td>
								<td class="heroes">{{ hero.value }}</td>
							</tr>
						{% endfor %}
					</table>
				  </div>
				</details>
			  </td>
			  <td>{{ row.score }}</td>
			</tr>
		  {% endfor %}
		{% else %}
		  {% for idx, (pid, name, level, value) in enumerate(rating, 1) %}
			<tr class="{% if idx == 1 %}gold{% elif idx == 2 %}silver{% elif idx == 3 %}bronze{% endif %}">
			  <td>{{ idx }}</td>
			  <td style="text-align: left;">
				<a href="https://wekings.online/hero/detail?player={{ pid }}" target="_blank">{{ name }} [{{ level }}]</a>
			  </td>
			  <td>{{ value }}</td>
			</tr>
		  {% endfor %}
		{% endif %}
	  </tbody>
	</table>
  </div>

	<script>
		document.addEventListener("DOMContentLoaded", () => {
			const toggleButton = document.getElementById("theme-toggle");
			const root = document.documentElement;
			const isDark = () => root.classList.contains("dark");
			const savedTheme = localStorage.getItem("theme");
			if (savedTheme === "dark") {root.classList.add("dark");}
			toggleButton.textContent = isDark() ? "‚òÄÔ∏è" : "üåô";

			toggleButton.addEventListener("click", () => {
				root.classList.toggle("dark");
				const next = isDark() ? "dark" : "light";
				localStorage.setItem("theme", next);
				toggleButton.textContent = isDark() ? "‚òÄÔ∏è" : "üåô";
			});
		});
	</script>

</body>
</html>
