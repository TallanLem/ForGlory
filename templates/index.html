<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<title>–†–µ–π—Ç–∏–Ω–≥</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
	<script>
		const theme = localStorage.getItem("theme");
		if (theme === "dark") {
			document.documentElement.classList.add("dark");
		}
	</script>
</head>
<body>
<div class="container">
	<div class="header-bar">
		<h1>–†–µ–π—Ç–∏–Ω–≥</h1>
		<button id="theme-toggle" onclick="toggleDarkMode()" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
	</div>

	<form method="POST" class="form">

		<div class="form-group inline">
			<label>–†–µ–∂–∏–º:</label>
			<label><input type="radio" name="mode" value="–û–±—â–∏–π" {% if mode == '–û–±—â–∏–π' %}checked{% endif %}> –û–±—â–∏–π</label>
			<label><input type="radio" name="mode" value="–ü—Ä–∏—Ä–æ—Å—Ç" {% if mode == '–ü—Ä–∏—Ä–æ—Å—Ç' %}checked{% endif %}> –ü—Ä–∏—Ä–æ—Å—Ç</label>
		</div>

		<div class="form-group" id="file-group" {% if mode != '–û–±—â–∏–π' %}style="display:none;"{% endif %}>
			<select name="file" id="file">
				{% for file in json_files %}
					{% set dt = extract_datetime_from_filename(file).strftime('%d.%m.%Y %H:%M') %}
					<option value="{{ file }}" {% if file == selected_file %}selected{% endif %}>{{ dt }}</option>
				{% endfor %}
			</select>
		</div>

		<div id="growth-group" class="form-group inline" {% if mode != '–ü—Ä–∏—Ä–æ—Å—Ç' %}style="display:none;"{% endif %}>
			<span>–æ—Ç</span>
			<select name="file1" id="file1">
				{% for file in json_files %}
					{% set dt = extract_datetime_from_filename(file).strftime('%d.%m.%Y %H:%M') %}
					<option value="{{ file }}" {% if file == file1 %}selected{% endif %}>{{ dt }}</option>
				{% endfor %}
			</select>
			<span>–¥–æ</span>
			<select name="file2" id="file2">
				{% for file in json_files %}
					{% set dt = extract_datetime_from_filename(file).strftime('%d.%m.%Y %H:%M') %}
					<option value="{{ file }}" {% if file == file2 %}selected{% endif %}>{{ dt }}</option>
				{% endfor %}
			</select>
		</div>

		<div class="form-group inline">
			<label for="param">–ü–∞—Ä–∞–º–µ—Ç—Ä:</label>
			<select name="param" id="param">
				{% for option in param_options %}
					<option value="{{ option }}" {% if option == param %}selected{% endif %}>{{ option }}</option>
				{% endfor %}
			</select>

			<select name="sort" id="sort">
				<option value="desc" {% if sort_dir == 'desc' %}selected{% endif %}>–ü–æ —É–±—ã–≤–∞–Ω–∏—é</option>
				<option value="asc" {% if sort_dir == 'asc' %}selected{% endif %}>–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é</option>
			</select>
		</div>
		<input type="text" name="filter" placeholder="–§–∏–ª—å—Ç—Ä –ø–æ –Ω–∏–∫—É" value="{{ filter_value or '' }}" class="input">
		<button type="submit">–ü–æ–∫–∞–∑–∞—Ç—å</button>
	</form>

	<p><strong>{{ filename_display }}</strong></p>

	<div class="table-container">
		<table>
			<thead>
			<tr>
				<th>‚Ññ</th>
				<th style="text-align: left;">–ò–≥—Ä–æ–∫</th>
				<th>{{ param }}</th>
			</tr>
			</thead>
			<tbody>
			{% for row in rating %}
				{% set idx = loop.index %}
				{% set pid, name, level, value = row %}
				{% set row_class = '' %}
				{% if idx == 1 %} {% set row_class = 'gold' %}
				{% elif idx == 2 %} {% set row_class = 'silver' %}
				{% elif idx == 3 %} {% set row_class = 'bronze' %}
				{% endif %}
				<tr class="{{ row_class }}">
					<td>{{ idx }}</td>
					<td style="text-align: left;">
						<a href="https://wekings.online/hero/detail?player={{ pid }}" target="_blank">{{ name }} [{{ level }}]</a>
					</td>
					<td>{{ value }}</td>
				</tr>
			{% endfor %}
			</tbody>
		</table>
	</div>
</div>

<script>
function toggleDarkMode() {
	const isDark = document.documentElement.classList.toggle("dark");
	localStorage.setItem("theme", isDark ? "dark" : "light");
	document.getElementById("theme-toggle").textContent = isDark ? "üåû" : "üåô";
}

window.addEventListener("DOMContentLoaded", () => {
	const isDark = document.documentElement.classList.contains("dark");
	document.getElementById("theme-toggle").textContent = isDark ? "üåû" : "üåô";

	const radioGrowth = document.querySelector('input[value="–ü—Ä–∏—Ä–æ—Å—Ç"]');
	const radioTotal = document.querySelector('input[value="–û–±—â–∏–π"]');
	const fileGroup = document.getElementById("file-group");
	const growthGroup = document.getElementById("growth-group");

	const updateVisibility = () => {
		const isGrowth = radioGrowth.checked;
		fileGroup.style.display = isGrowth ? "none" : "block";
		growthGroup.style.display = isGrowth ? "flex" : "none";
	};

	radioGrowth.addEventListener("change", updateVisibility);
	radioTotal.addEventListener("change", updateVisibility);
	updateVisibility();  // –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
});
</script>
</body>
</html>
